webpackJsonp([6],{"59ix":function(o,e){},lmfZ:function(o,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});t("qpxo"),t("YY9M"),t("1LXj"),t("vw/H");var n=t("vLgD"),r=t("mtWM"),a=t.n(r),s=t("JU1R"),i=t("ZQ6q"),l=t.n(i),c={data:function(){return{loginForm:{account:"",password:""},loading:!1}},methods:{handleLogin:function(){var o=this;this.loading=!0,n.a.post("/api/login/",{account:this.loginForm.account,password:this.loginForm.password},{headers:{"X-CSRFToken":l.a.get("csrftoken")}}).then(function(e){console.log("登录响应:",e.data);var t=e.data.access;localStorage.setItem("token",t),a.a.defaults.headers.common.Authorization="Bearer ".concat(t),o.$store.commit("SET_TOKEN",t),e.data&&o.$store.commit("SET_USER",e.data.user);var n=e.data.user.menu_tree||[];localStorage.setItem("token",t),o.$store.commit("SET_MENU_TREE",n),localStorage.setItem("menuTree",JSON.stringify(n)),Object(s.a)(n);var r=n.length>0&&n[0].path||"/dashboard";setTimeout(function(){console.log("尝试跳转到: ".concat(r)),o.$router.push(r).catch(function(e){"NavigationDuplicated"!==e.name&&(console.error("导航错误:",e),o.$router.push("/dashboard"))})},200)}).catch(function(e){console.error("登录过程中发生错误:",e);var t="登录失败";e.response&&(401===e.response.status?t="账号或密码错误":e.response.data&&e.response.data.detail&&(t=e.response.data.detail)),o.$message.error(t)}).finally(function(){o.loading=!1})},goToRegister:function(){this.$router.push("/register")},goToForgotPassword:function(){this.$router.push("/forgot-password")}}},d={render:function(){var o=this,e=o.$createElement,t=o._self._c||e;return t("div",{staticClass:"login-container"},[t("el-form",{ref:"form",staticClass:"login-form",attrs:{model:o.loginForm}},[t("h2",[o._v("系统登录")]),o._v(" "),t("el-form-item",[t("el-input",{attrs:{"prefix-icon":"el-icon-user",placeholder:"账号"},model:{value:o.loginForm.account,callback:function(e){o.$set(o.loginForm,"account",e)},expression:"loginForm.account"}})],1),o._v(" "),t("el-form-item",[t("el-input",{attrs:{"prefix-icon":"el-icon-lock",type:"password",placeholder:"密码"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&o._k(e.keyCode,"enter",13,e.key,"Enter")?null:o.handleLogin(e)}},model:{value:o.loginForm.password,callback:function(e){o.$set(o.loginForm,"password",e)},expression:"loginForm.password"}})],1),o._v(" "),t("el-form-item",[t("el-button",{staticClass:"login-btn",attrs:{type:"primary",loading:o.loading},on:{click:o.handleLogin}},[o._v("登录")])],1),o._v(" "),t("div",{staticClass:"auth-links"},[t("el-link",{attrs:{type:"primary"},on:{click:o.goToRegister}},[o._v("注册账号")]),o._v(" "),t("el-divider",{attrs:{direction:"vertical"}}),o._v(" "),t("el-link",{attrs:{type:"primary"},on:{click:o.goToForgotPassword}},[o._v("忘记密码")])],1)],1)],1)},staticRenderFns:[]};var u=t("VU/8")(c,d,!1,function(o){t("59ix")},"data-v-3effddd8",null);e.default=u.exports}});
//# sourceMappingURL=6.773d895538456b016d8d.js.map